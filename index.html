<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ONE LOTO - Reservas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #4b0082, #800080);
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh; padding: 1rem; color: #fff;
    }
    .container {
      background: #1a001f;
      padding: 1.5rem;
      border-radius: 20px;
      max-width: 450px; width: 100%;
      box-shadow: 0 0 25px rgba(0,0,0,.5);
      animation: fadeIn 1s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(.9);}
      to {opacity: 1; transform: scale(1);}
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      color: #ffd700;
      font-size: 1.8rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: .6rem; margin-bottom: 1.2rem;
    }
    .num {
      border: none;
      padding: 1rem; border-radius: 12px;
      font-weight: bold; font-size: 1rem;
      cursor: pointer; transition: .3s;
      background: #4b0082; color: #fff;
      animation: pulse 1.5s infinite;
    }
    .num:hover { transform: scale(1.08); background: #6a0dad; }
    .num.active { background: #ffd700; color: #000; animation: none; }
    .num.reservada {
      background: #ff4d4d !important;
      color: #fff; cursor: not-allowed;
      animation: none;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
    }
    input {
      width: 100%; padding: .9rem; border: none;
      border-radius: 8px; margin-bottom: 1rem;
      font-size: 1rem;
    }
    button {
      width: 100%; padding: 1rem; border: none;
      border-radius: 8px;
      background: linear-gradient(45deg,#ffd700,#ffa500);
      font-weight: bold; font-size: 1.05rem;
      cursor: pointer; transition: .3s;
    }
    button:hover { opacity: .9; }
    .msg {
      margin-top: 1rem; padding: .8rem;
      border-radius: 8px; text-align: center;
      font-weight: bold; display: none;
    }
    .msg.ok { background: #32cd32; color: #000; display: block; }
    .msg.erro { background: #ff4d4d; color: #fff; display: block; }
    .info {
      margin-top: 1.5rem; font-size: .9rem; line-height: 1.5;
      text-align: center;
    }
    .contador {
      margin-bottom: 1rem; text-align: center;
      font-size: 1.05rem; font-weight: bold;
      color: #ffd700;
    }
    /* Responsividade */
    @media (max-width: 480px) {
      .container { padding: 1rem; }
      .num { padding: .8rem; font-size: .9rem; }
      button, input { font-size: .95rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üíú ONE LOTO üíú</h1>
    <p style="margin-bottom:1rem; text-align:center;">Escolha sua dezena:</p>
    <div id="contador" class="contador">Carregando...</div>
    <div class="grid" id="grid"></div>
    <input type="text" id="nome" placeholder="Digite seu nome" />
    <button onclick="reservar()">‚úÖ Reservar Dezena</button>
    <div id="mensagem" class="msg"></div>
    <div class="info">
      <p>üí∞ Valor por dezena: <b>R$15,00</b></p>
      <p>üèÜ Pr√™mio fixo: <b>R$263,00</b></p>
      <p>üéØ Todo dia tem 1 ganhador</p>
      <p>‚ö†Ô∏è Cada dezena s√≥ pode ser comprada uma vez</p>
      <p>‚è∞ Pagamento at√© √†s 17:00</p>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzfKrgS3fWdYJ9mtuGvg0sL-XoO0A2cdN0S3MpNe962iWXUPl_YaXT9yJS3I7TrYy15Gw/exec";

    const grid = document.getElementById("grid");
    const contador = document.getElementById("contador");
    let dezenaSelecionada = null;

    // Monta a grade de 1 a 25
    for (let i = 1; i <= 25; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.className = "num";
      btn.id = "dezena-" + i;
      btn.onclick = () => {
        if (btn.classList.contains("reservada")) return;
        document.querySelectorAll(".num").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        dezenaSelecionada = i;
      };
      grid.appendChild(btn);
    }

    // Atualiza reservas e contador
    async function carregarReservas() {
      try {
        const resp = await fetch(SCRIPT_URL + "?action=getReservas");
        const data = await resp.json();
        if (data.reservas) {
          // marca bot√µes
          data.reservas.forEach(num => {
            const btn = document.getElementById("dezena-" + num);
            if (btn) {
              btn.classList.add("reservada");
              btn.disabled = true;
            }
          });
          // contador
          const total = 25;
          const reservadas = data.reservas.length;
          const disponiveis = total - reservadas;
          contador.textContent = `üî• Restam ${disponiveis} dezenas dispon√≠veis de ${total}`;
        }
      } catch (e) {
        contador.textContent = "Erro ao carregar reservas.";
      }
    }

    async function reservar() {
      const nome = document.getElementById("nome").value.trim();
      const msg = document.getElementById("mensagem");

      if (!nome || !dezenaSelecionada) {
        msg.textContent = "‚ö†Ô∏è Digite seu nome e escolha uma dezena!";
        msg.className = "msg erro";
        return;
      }

      try {
        const resp = await fetch(`${SCRIPT_URL}?action=reserva&nome=${encodeURIComponent(nome)}&dezena=${dezenaSelecionada}`);
        const data = await resp.json();

        msg.textContent = data.mensagem;
        msg.className = "msg " + (data.status === "sucesso" ? "ok" : "erro");

        if (data.status === "sucesso") {
          const btn = document.getElementById("dezena-" + dezenaSelecionada);
          btn.classList.add("reservada");
          btn.disabled = true;
          dezenaSelecionada = null;
          document.getElementById("nome").value = "";
          carregarReservas(); // atualiza contador
        }
      } catch (e) {
        msg.textContent = "Erro ao conectar ao servidor.";
        msg.className = "msg erro";
      }
    }

    // Carrega reservas ao abrir
    carregarReservas();
  </script>
</body>
</html>
