<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz9qbddwxyLK6woNkyYjsiMd68S3woUsyj3AvjnJ4-5191d1nqIxV7FffYU5Dm_CmVO/exec";

// Array de dezenas
const dezenasDisponiveis = Array.from({length:25},(_,i)=>({num:i+1, comprado:false}));

const container = document.getElementById('cotacoes');
dezenasDisponiveis.forEach(d=>{
  const label = document.createElement('label');
  label.className='cota-opcao';
  label.innerHTML=`<input type="radio" name="dezena" value="${d.num}"><div class="box-cota">${d.num}</div>`;
  container.appendChild(label);
});

function atualizarUI(){
  const boxes = document.querySelectorAll('.box-cota');
  boxes.forEach(box=>{
    const val = parseInt(box.textContent);
    const dez = dezenasDisponiveis.find(d=>d.num===val);
    if(dez.comprado){
      box.classList.add('disabled');
      box.previousElementSibling.disabled=true;
    }
  });
}

// Carregar dezenas já reservadas da planilha
fetch(API_URL)
  .then(res => res.json())
  .then(reservadas => {
    reservadas.forEach(num => {
      const dez = dezenasDisponiveis.find(d=>d.num==num);
      if (dez) dez.comprado = true;
    });
    atualizarUI();
  });

const formulario = document.getElementById('formulario');
const mensagem = document.getElementById('mensagem');

formulario.addEventListener('submit', e=>{
  e.preventDefault();
  const nome = document.getElementById('nome').value.trim();
  const dezena = parseInt(document.querySelector('input[name="dezena"]:checked')?.value);

  if(!nome || !dezena){
    mensagem.textContent='❌ Preencha seu nome e escolha uma dezena.';
    mensagem.className='erro';
    mensagem.style.display='block';
    return;
  }

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ nome, dezena }),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.json())
  .then(ret => {
    mensagem.textContent = ret.msg;
    mensagem.className = ret.status === "ok" ? 'sucesso' : 'erro';
    mensagem.style.display = 'block';
    if (ret.status === "ok") {
      dezenasDisponiveis.find(d=>d.num===dezena).comprado = true;
      atualizarUI();
      formulario.reset();
    }
  })
  .catch(() => {
    mensagem.textContent='❌ Erro ao conectar com o servidor.';
    mensagem.className='erro';
    mensagem.style.display='block';
  });
});
</script>
