<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>One Loto</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet" />
<style>
/* ... mesmo CSS que vocÃª enviou ... */
</style>
</head>
<body>
<main class="card">
<h1>ğŸ’œ ONE LOTO ğŸ’œ</h1>

<form id="formulario" novalidate>
<label for="nome">Seu nome:</label>
<input type="text" id="nome" name="nome" placeholder="Digite seu nome completo" required />

<label>Escolha sua dezena:</label>
<div class="cotacoes" id="cotacoes"></div>

<button type="submit">âœ… Reservar Dezena</button>
</form>

<section class="info-bolao">
<p>ğŸ’œ <strong>ONE LOTO</strong> ğŸ’œ</p>
<p>ğŸ’° Valor por dezena: R$15,00</p>
<p>ğŸ† PrÃªmio fixo: R$263,00</p>
<p>ğŸ’¸ Todo dia tem 1 Ganhador</p>
<p>âš ï¸ Cada dezena sÃ³ pode ser comprada uma vez!</p>
<p>âŒš Pagamento atÃ© as <strong>17:00</strong></p>
</section>

<div id="mensagem"></div>
</main>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz9qbddwxyLK6woNkyYjsiMd68S3woUsyj3AvjnJ4-5191d1nqIxV7FffYU5Dm_CmVO/exec";

// Array inicial (vai atualizar com a planilha)
let dezenasDisponiveis = Array.from({length:25},(_,i)=>({num:i+1, comprado:false}));

const container = document.getElementById('cotacoes');
const mensagem = document.getElementById('mensagem');

// Criar botÃµes das dezenas
function criarDezenas(){
  container.innerHTML = "";
  dezenasDisponiveis.forEach(d=>{
    const label = document.createElement('label');
    label.className='cota-opcao';
    label.innerHTML=`<input type="radio" name="dezena" value="${d.num}" ${d.comprado?'disabled':''}>
                     <div class="box-cota ${d.comprado?'disabled':''}">${d.num}</div>`;
    container.appendChild(label);
  });
}

// Buscar dados da planilha e bloquear as compradas
async function carregarDezenas(){
  try {
    const res = await fetch(SCRIPT_URL);
    const data = await res.json();
    // data esperado: [{num: 1, comprado: true}, ...]
    dezenasDisponiveis = dezenasDisponiveis.map(d=>{
      const comprado = data.some(item=>parseInt(item.dezena) === d.num);
      return {...d, comprado};
    });
    criarDezenas();
  } catch(e){
    console.error("Erro ao carregar planilha", e);
  }
}

document.getElementById('formulario').addEventListener('submit', async e=>{
  e.preventDefault();
  const nome = document.getElementById('nome').value.trim();
  const dezena = document.querySelector('input[name="dezena"]:checked')?.value;

  if(!nome || !dezena){
    mensagem.textContent='âŒ Preencha seu nome e escolha uma dezena.';
    mensagem.className='erro';
    mensagem.style.display='block';
    return;
  }

  try {
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: `nome=${encodeURIComponent(nome)}&dezena=${encodeURIComponent(dezena)}`
    });

    mensagem.textContent=`âœ… ${nome}, vocÃª reservou a dezena ${dezena}! Seu PrÃªmio serÃ¡ R$263,00.`;
    mensagem.className='sucesso';
    mensagem.style.display='block';
    document.getElementById('formulario').reset();
    carregarDezenas();
  } catch(err){
    mensagem.textContent='âŒ Erro ao enviar dados. Tente novamente.';
    mensagem.className='erro';
    mensagem.style.display='block';
  }
});

// Carregar na abertura
carregarDezenas();
</script>
</body>
</html>
