<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ONE LOTO - Reservas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #4b0082, #800080);
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh; padding: 2rem; color: #fff;
    }
    .container {
      background: #1a001f;
      padding: 2rem;
      border-radius: 20px;
      max-width: 450px; width: 100%;
      box-shadow: 0 0 25px rgba(0,0,0,.5);
      animation: fadeIn 1s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: scale(.9);}
      to {opacity: 1; transform: scale(1);}
    }
    h1 { text-align: center; margin-bottom: 1rem; color: #ffd700; font-size: 2rem; }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: .6rem; margin-bottom: 1.2rem;
    }
    .num {
      border: none;
      padding: 1rem; border-radius: 12px;
      font-weight: bold; font-size: 1rem;
      cursor: pointer; transition: .3s;
      background: #4b0082; color: #fff;
      animation: pulse 1.5s infinite;
    }
    .num:hover { transform: scale(1.1); background: #6a0dad; }
    .num.active { background: #ffd700; color: #000; animation: none; }
    .num.reservada {
      background: #ff4d4d !important;
      color: #fff; cursor: not-allowed;
      animation: none;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
    }
    input {
      width: 100%; padding: .9rem; border: none;
      border-radius: 8px; margin-bottom: 1rem;
      font-size: 1rem;
    }
    button {
      width: 100%; padding: 1rem; border: none;
      border-radius: 8px;
      background: linear-gradient(45deg,#ffd700,#ffa500);
      font-weight: bold; font-size: 1.1rem;
      cursor: pointer; transition: .3s;
    }
    button:hover { opacity: .85; }
    .msg {
      margin-top: 1rem; padding: .8rem;
      border-radius: 8px; text-align: center;
      font-weight: bold; display: none;
    }
    .msg.ok { background: #32cd32; color: #000; display: block; }
    .msg.erro { background: #ff4d4d; color: #fff; display: block; }
    .info {
      margin-top: 1.5rem; font-size: .9rem; line-height: 1.5;
      text-align: center;
    }
    .contador {
      margin-bottom: 1rem; text-align: center;
      font-size: 1.1rem; font-weight: bold;
      color: #ffd700;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>💜 ONE LOTO 💜</h1>
    <p style="margin-bottom:1rem; text-align:center;">Escolha sua dezena:</p>
    <div id="contador" class="contador">Carregando...</div>
    <div class="grid" id="grid"></div>
    <input type="text" id="nome" placeholder="Digite seu nome" />
    <button onclick="reservar()">✅ Reservar Dezena</button>
    <div id="mensagem" class="msg"></div>
    <div class="info">
      <p>💰𝐕𝐚𝐥𝐨𝐫 𝐩𝐨𝐫 𝐝𝐞𝐳𝐞𝐧𝐚: <b>R$15,00</b></p>
      <p>🏆 𝙥𝙧𝙚𝙢𝙞𝙤 𝙛𝙞𝙭𝙤: <b>R$263,00</b></p>
      <p>🎯 𝐓𝐨𝐝𝐨 𝐝𝐢𝐚 𝐭𝐞𝐦 𝟏 𝐠𝐚𝐧𝐡𝐚𝐝𝐨𝐫</p>
      <p>⚠️ 𝐂𝐚𝐝𝐚 𝐝𝐞𝐳𝐞𝐧𝐚 𝐬𝐨́ 𝐩𝐨𝐝𝐞 𝐬𝐞𝐫 𝐜𝐨𝐦𝐩𝐫𝐚𝐝𝐚 𝐮𝐦𝐚 𝐯𝐞𝐳</p>
      <p>⏰ 𝐏𝐚𝐠𝐚𝐦𝐞𝐧𝐭𝐨 𝐚𝐭𝐞́ 𝐚𝐬 𝟏𝟕:𝟎𝟎</p>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwG_eSs89S_oAlWwylbZTgBUwpV1aAaOfl8bcArQQNx3k3KkMI7kocFfSY-tvWdyC0HLw/exec";

    const grid = document.getElementById("grid");
    const contador = document.getElementById("contador");
    let dezenaSelecionada = null;

    // Monta a grade de 1 a 25
    for (let i = 1; i <= 25; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.className = "num";
      btn.id = "dezena-" + i;
      btn.onclick = () => {
        if (btn.classList.contains("reservada")) return;
        document.querySelectorAll(".num").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        dezenaSelecionada = i;
      };
      grid.appendChild(btn);
    }

    // Atualiza reservas e contador
    async function carregarReservas() {
      try {
        const resp = await fetch(SCRIPT_URL + "?action=getReservas");
        const data = await resp.json();
        if (data.reservas) {
          // marca botões
          data.reservas.forEach(num => {
            const btn = document.getElementById("dezena-" + num);
            if (btn) {
              btn.classList.add("reservada");
              btn.disabled = true;
            }
          });
          // contador
          const total = 25;
          const reservadas = data.reservas.length;
          const disponiveis = total - reservadas;
          contador.textContent = `🔥 Restam ${disponiveis} dezenas disponíveis de ${total}`;
        }
      } catch (e) {
        contador.textContent = "Erro ao carregar reservas.";
      }
    }

    async function reservar() {
      const nome = document.getElementById("nome").value.trim();
      const msg = document.getElementById("mensagem");

      if (!nome || !dezenaSelecionada) {
        msg.textContent = "⚠️ Digite seu nome e escolha uma dezena!";
        msg.className = "msg erro";
        return;
      }

      try {
        const resp = await fetch(`${SCRIPT_URL}?action=reserva&nome=${encodeURIComponent(nome)}&dezena=${dezenaSelecionada}`);
        const data = await resp.json();

        msg.textContent = data.mensagem;
        msg.className = "msg " + (data.status === "sucesso" ? "ok" : "erro");

        if (data.status === "sucesso") {
          const btn = document.getElementById("dezena-" + dezenaSelecionada);
          btn.classList.add("reservada");
          btn.disabled = true;
          dezenaSelecionada = null;
          document.getElementById("nome").value = "";
          carregarReservas(); // atualiza contador
        }
      } catch (e) {
        msg.textContent = "Erro ao conectar ao servidor.";
        msg.className = "msg erro";
      }
    }

    // Carrega reservas ao abrir
    carregarReservas();
  </script>
</body>
</html>
