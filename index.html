<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONE LOTO - Reservas</title>
  <style>
    body{font-family:sans-serif;background:#2c003e;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;}
    .container{background:#1a001f;padding:20px;border-radius:12px;max-width:420px;width:100%;box-shadow:0 0 15px rgba(0,0,0,0.5);}
    h1{text-align:center;color:#ffd700;}
    .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin:15px 0;}
    .num{padding:12px;background:#4b0082;border:none;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;transition:.3s;}
    .num:hover{background:#6a0dad;}
    .num.active{background:#ffd700;color:#000;}
    .num.reservado{background:#555;color:#aaa;cursor:not-allowed;}
    input,button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:8px;font-size:1rem;}
    button{background:linear-gradient(45deg,#ffd700,#ffa500);font-weight:bold;cursor:pointer;}
    button:hover{opacity:0.9;}
    .msg{margin-top:10px;padding:10px;border-radius:8px;text-align:center;display:none;}
    .msg.ok{background:#32cd32;color:#000;display:block;}
    .msg.erro{background:#ff4d4d;color:#fff;display:block;}
  </style>
</head>
<body>
  <div class="container">
    <h1>ONE LOTO</h1>
    <p>Escolha sua dezena:</p>
    <div id="grid" class="grid"></div>
    <input type="text" id="nome" placeholder="Digite seu nome">
    <button onclick="reservar()">✅ Reservar</button>
    <div id="mensagem" class="msg"></div>
  </div>

  <script>
    // 🔗 SUA URL DO APPS SCRIPT (troque aqui)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzYBnZARUnmqxAqxBoP6Aslga2RoMo-MZLjZJu95kMJ2TBu7IUB8met5vvOsSkq9gPEQg/exec";

    const grid=document.getElementById("grid");
    let dezenaSelecionada=null;

    // Monta grade de 1 a 25
    for(let i=1;i<=25;i++){
      const btn=document.createElement("button");
      btn.textContent=i;
      btn.className="num";
      btn.onclick=()=>{
        if(btn.classList.contains("reservado"))return;
        document.querySelectorAll(".num").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        dezenaSelecionada=i;
      };
      grid.appendChild(btn);
    }

    // 🔹 Carrega as dezenas já reservadas do Google Sheets
    async function carregarReservadas(){
      try{
        const resp=await fetch(SCRIPT_URL);
        const data=await resp.json();
        if(data.sucesso){
          data.dezenas.forEach(d=>{
            const btn=[...document.querySelectorAll(".num")].find(b=>b.textContent==d);
            if(btn){btn.classList.add("reservado");btn.disabled=true;}
          });
        }
      }catch(e){
        console.error("Erro ao carregar dezenas reservadas",e);
      }
    }

    // 🔹 Envia reserva
    async function reservar(){
      const nome=document.getElementById("nome").value.trim();
      const msg=document.getElementById("mensagem");

      if(!nome||!dezenaSelecionada){
        msg.textContent="⚠️ Digite seu nome e escolha uma dezena!";
        msg.className="msg erro";return;
      }

      try{
        const resp=await fetch(SCRIPT_URL,{
          method:"POST",
          body:JSON.stringify({nome:nome,dezena:dezenaSelecionada})
        });
        const data=await resp.json();
        msg.textContent=data.mensagem;
        msg.className="msg "+(data.sucesso?"ok":"erro");

        if(data.sucesso){
          const btn=[...document.querySelectorAll(".num")].find(b=>b.textContent==dezenaSelecionada);
          if(btn){btn.classList.add("reservado");btn.disabled=true;}
        }
      }catch(e){
        msg.textContent="Erro ao conectar ao servidor.";
        msg.className="msg erro";
      }
    }

    // 🚀 Ao abrir a página, já bloqueia as dezenas reservadas
    carregarReservadas();
  </script>
</body>
</html>
